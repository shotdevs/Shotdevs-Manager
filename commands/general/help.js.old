const {
    SlashCommandBuilder,
    EmbedBuilder,
    ActionRowBuilder,
    ButtonBuilder,
    ButtonStyle
} = require('discord.js');

// Category emojis and descriptions
const CATEGORY_INFO = {
    general: {
        emoji: 'üîß',
        description: 'General purpose commands'
    },
    moderation: {
        emoji: 'üõ°Ô∏è',
        description: 'Moderation and server management'
    },
    levels: {
        emoji: 'üìä',
        description: 'Leveling system and rankings'
    },
    utility: {
        emoji: 'üõ†Ô∏è',
        description: 'Utility and configuration commands'
    }
};

module.exports = {
    category: 'General',
    data: new SlashCommandBuilder()
        .setName('help')
        .setDescription('Lists all available commands.'),
    async execute(interaction) {
        const commands = interaction.client.commands;
        const categories = {};

        // Group commands by category
        commands.forEach(command => {
            const category = command.category || 'General';
            if (!categories[category]) {
                categories[category] = [];
            }
            categories[category].push(command);
        });

        // Create the help embed
        const helpEmbed = new EmbedBuilder()
            .setColor(0x5865F2)
            .setTitle('ü§ñ Shotdevs Manager Commands')
            .setDescription('Here\'s a list of all available commands, sorted by category.\nClick on any command to use it!')
            .setThumbnail(interaction.client.user.displayAvatarURL({ dynamic: true }));

        // Add categories and commands to the embed
        for (const [categoryName, categoryCommands] of Object.entries(categories)) {
            const formattedCategoryName = categoryName.toLowerCase();
            const info = CATEGORY_INFO[formattedCategoryName] || { 
                emoji: 'üìÅ',
                description: `${categoryName} commands`
            };

            // Create clickable command mentions if IDs are available
            const commandList = categoryCommands.map(cmd => {
                const mention = cmd.id ? `</${cmd.data.name}:${cmd.id}>` : `\`/${cmd.data.name}\``;
                return `‚Ä¢ ${mention} ‚Äî ${cmd.data.description}`;
            }).join('\n');

            helpEmbed.addFields({
                name: `${info.emoji} ${categoryName}`,
                value: `${info.description}\n${commandList}`,
                inline: false
            });
        }

        // Add a footer with command count
        const totalCommands = commands.size;
        helpEmbed.setFooter({ 
            text: `${totalCommands} commands available ‚Ä¢ Type / to get started`
        });

        // Create a row of buttons
        const buttonsRow = new ActionRowBuilder()
            .addComponents(
                new ButtonBuilder()
                    .setStyle(ButtonStyle.Link)
                    .setLabel('üåê Visit Website')
                    .setURL('https://shotdevs.live'),
                new ButtonBuilder()
                    .setStyle(ButtonStyle.Link)
                    .setLabel('üíª GitHub')
                    .setURL('https://github.com/shotdevs'),
                new ButtonBuilder()
                    .setStyle(ButtonStyle.Link)
                    .setLabel('üéÆ Join Discord')
                    .setURL('https://discord.gg/shotdevs')
            );

        await interaction.reply({
            embeds: [helpEmbed],
            components: [buttonsRow],
            flags: ['Ephemeral']
        });
    },
};
